<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Swift 使用Runtime自定义UIDatePicker · qiuyu's Blog</title><meta name="description" content="Swift 使用Runtime自定义UIDatePicker - wang-qiuyu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="qiuyu's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/5677800872" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/wang-qiuyu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Swift 使用Runtime自定义UIDatePicker</h1><div class="post-info">Feb 5, 2018</div><div class="post-content"><h4 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h4><p>UIDatePicker是比较常用的一个控件了，但是苹果却只提供极少的属性可以让我们使用，所以实际运用中难免要自定义。这里我提供俩种方法来改变UIDatePicker的显示字体颜色。显示效果如下：</p>
<hr>
<p><img src="http://upload-images.jianshu.io/upload_images/299599-710738310ceb21d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2017-12-07 下午11.06.45.png"></p>
<hr>
<h4 id="首先是第一种方法：runtime"><a href="#首先是第一种方法：runtime" class="headerlink" title="首先是第一种方法：runtime"></a>首先是第一种方法：runtime</h4><p>我们知道，runtime可以遍历一个对象的所有属性，虽然苹果没有公开UIDatePicker的字体颜色，但是我们可以遍历查找对应的属性名，并加以修改就可以实现了。<br>关键代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//MARK:runtime遍历所有属性名，并加以修改</span><br><span class="line">    func setDateTextColor(picker:UIDatePicker)&#123;</span><br><span class="line">        var count:UInt32 = 0</span><br><span class="line">        let propertys = class_copyPropertyList(UIDatePicker.self, &amp;count)</span><br><span class="line">        for index in 0..&lt;count &#123;</span><br><span class="line">            let i = Int(index)</span><br><span class="line">            let property = propertys![i]</span><br><span class="line">            let propertyName = property_getName(property)</span><br><span class="line">            </span><br><span class="line">            let strName = String.init(cString: propertyName, encoding: String.Encoding.utf8)</span><br><span class="line">            if strName == &quot;textColor&quot;&#123;</span><br><span class="line">                picker.setValue(UIColor.red, forKey: strName!)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="第二种方法：自定义UIPickerView"><a href="#第二种方法：自定义UIPickerView" class="headerlink" title="第二种方法：自定义UIPickerView"></a>第二种方法：自定义UIPickerView</h4><p>相比而言，UIPickerView可以使用比较多的属性进行操作，所以我们不妨曲线救国，使用UIPickerView来实现UIDatePicker的功能。此方法比较繁琐，但是可以高度自定义。</p>
<p>具体思路：</p>
<ul>
<li>准备3个数组存放年，月，日的数据，其中日的数组要根据相应的年和月来处理不同情况，月份还有闰年都会影响到，所以这一步需要小心计算。</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/// 计算每个月的天数</span><br><span class="line">    fileprivate func daysCount(year:Int,month:Int) -&gt; Int&#123;</span><br><span class="line">        let isrunNian = year%4 == 0 ? (year%100 == 0 ? (year%400 == 0 ? true:false):true):false</span><br><span class="line">        if month == 1 || month == 3 || month == 5 || month == 7 || month == 8 || month == 10 || month == 12&#123;</span><br><span class="line">            self.setDayArr(num: 31)</span><br><span class="line">            return 31</span><br><span class="line">        &#125;else if month == 4 || month == 6 || month == 9 || month == 11&#123;</span><br><span class="line">            self.setDayArr(num: 30)</span><br><span class="line">            return 30</span><br><span class="line">        &#125;else if month == 2&#123;</span><br><span class="line">            if isrunNian&#123;</span><br><span class="line">                self.setDayArr(num: 29)</span><br><span class="line">                return 29</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                self.setDayArr(num: 28)</span><br><span class="line">                return 28</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return 0</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据源准备好后，就开始实现UIPickerView的代理方法吧，切换年或者月份的时候会影响到日这一列的数据。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">func pickerView(_ pickerView: UIPickerView, didSelectRow row: Int, inComponent component: Int) &#123;</span><br><span class="line">        if component == 0 &#123;</span><br><span class="line">            yearIndex = row</span><br><span class="line">        &#125;</span><br><span class="line">        if component == 1 &#123;</span><br><span class="line">            monthIndex = row</span><br><span class="line">        &#125;</span><br><span class="line">        if component == 2 &#123;</span><br><span class="line">            dayIndex = row</span><br><span class="line">        &#125;</span><br><span class="line">        if component == 0 || component == 1&#123;</span><br><span class="line">            let selctYear = (yearArray![yearIndex!] as! NSString).intValue</span><br><span class="line">            let selctMonth = (monthArray![monthIndex!] as! NSString).intValue</span><br><span class="line">            let _ = self.daysCount(year: Int(selctYear) , month: Int(selctMonth))</span><br><span class="line">            </span><br><span class="line">            if (dayArray?.count)!-1 &lt; dayIndex! &#123;</span><br><span class="line">                dayIndex = (dayArray?.count)!-1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        pickerView.reloadAllComponents()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>最后别忘了我们的初衷，就是自定义显示字体颜色。重写<br><strong>pickerView viewForRow: forComponent:(NSInteger)component reusingView:</strong>方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">func pickerView(_ pickerView: UIPickerView, viewForRow row: Int, forComponent component: Int, reusing view: UIView?) -&gt; UIView &#123;</span><br><span class="line">        let headLabel = UILabel.init()</span><br><span class="line">        headLabel.textColor  = UIColor.red</span><br><span class="line">        headLabel.textAlignment = NSTextAlignment.center</span><br><span class="line">        if component == 0 &#123;</span><br><span class="line">            headLabel.text = yearArray?[row] as? String</span><br><span class="line">        &#125;</span><br><span class="line">        if component == 1 &#123;</span><br><span class="line">            headLabel.text = monthArray?[row] as? String</span><br><span class="line">        &#125;</span><br><span class="line">        if component == 2 &#123;</span><br><span class="line">            headLabel.text = dayArray?[row] as? String</span><br><span class="line">        &#125;</span><br><span class="line">        return headLabel</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这样就大功告成了。</p>
<hr>
<h4 id="结语：Swift和OC在使用上还是有不少区别的，我刚用的时候也踩了不少坑，不过对于数据类型的使用确实比较严谨，感觉程序应该会更健壮了。"><a href="#结语：Swift和OC在使用上还是有不少区别的，我刚用的时候也踩了不少坑，不过对于数据类型的使用确实比较严谨，感觉程序应该会更健壮了。" class="headerlink" title="结语：Swift和OC在使用上还是有不少区别的，我刚用的时候也踩了不少坑，不过对于数据类型的使用确实比较严谨，感觉程序应该会更健壮了。"></a>结语：Swift和OC在使用上还是有不少区别的，我刚用的时候也踩了不少坑，不过对于数据类型的使用确实比较严谨，感觉程序应该会更健壮了。</h4><p>github项目地址： <a href="https://github.com/hfq-wangqiuyu/CustomDatePicker" target="_blank" rel="noopener">https://github.com/hfq-wangqiuyu/CustomDatePicker</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/02/06/在画布上涂鸦并截取画笔轨迹保存到相册/" class="prev">上一篇</a><a href="/2018/02/05/hello-world/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">wang-qiuyu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>