<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOS圆球沿着椭圆轨迹做动画 · Hexo</title><meta name="description" content="iOS圆球沿着椭圆轨迹做动画 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Hexo"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/5677800872" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/wang-qiuyu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOS圆球沿着椭圆轨迹做动画</h1><div class="post-info">Feb 6, 2018</div><div class="post-content"><p>前言：最近公司项目有个需求，需要实现让一个view沿着椭圆轨迹做动画，效果实现后，就自己封装做了一个小demo，使用更方便。先看效果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/299599-76e9f76b5bcbd85b.gif?imageMogr2/auto-orient/strip" alt="椭圆.gif"></p>
<p><em><br> 效果图中的白色椭圆轨迹线其实是用贝塞尔曲线画出来的，为了清晰的看出来运动的轨迹。其实项目中是不显示轨迹线的，也就是小球是悬空运动的。若不需要删除掉即可。
</em><br><strong><br>实现步骤：
</strong></p>
<p>1.首先设定关键帧动画<strong>CAKeyframeAnimation</strong>的一些属性，比如运动时间和重复次数和calculationMode模式，我们选择<strong>kCAAnimationPaced</strong> 使得动画均匀进行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    CAKeyframeAnimation *pathAnimation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">    pathAnimation.calculationMode = kCAAnimationPaced;</span><br><span class="line">    pathAnimation.fillMode = kCAFillModeForwards;</span><br><span class="line">    pathAnimation.removedOnCompletion = NO;</span><br><span class="line">    pathAnimation.duration = 5.0;</span><br><span class="line">    pathAnimation.repeatCount = 2;</span><br></pre></td></tr></table></figure>
<p>2.设定好关键帧动画的path，即一个椭圆形的路径。需要使用<strong>CGPathAddArc</strong>，<strong>CGPathAddArc</strong>经常用于画正圆，比如下面就是一个正圆，各个参数的意义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> //160,200为圆心,100为半径 （startAngle，endAngle）为起始角度和结束角度，1为顺时针，0 为逆时针</span><br><span class="line"> CGPathAddArc(curvedPath, NULL, 160,200, 100, startAngle, endAngle, 0);</span><br></pre></td></tr></table></figure>
<p><em><br>需要注意的是由于iOS中的坐标体系是和Quartz坐标体系中Y轴相反的，所以iOS UIView在做Quartz绘图时，Y轴已经做了Scale为-1的转换，因此造成CGPathAddArc函数最后一个是否是顺时针的参数结果正好是相反的，也就是说如果设置最后的参数为YES，根据参数定义应该是顺时针的，但实际绘图结果会是逆时针的！
</em><br>我们需要画的是椭圆啊，别急，接下来稍作更改即可。正圆第二个参数默认为NULL，我们要改成椭圆，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//短半轴和长半轴的比例</span><br><span class="line">    float radiuscale = 0.5;</span><br><span class="line">//椭圆顶点的坐标值</span><br><span class="line">    CGFloat origin_x = self.frame.size.width/2;</span><br><span class="line">    CGFloat origin_y = self.frame.size.height/2;</span><br><span class="line">//长半轴的长</span><br><span class="line">    CGFloat radiusX = 100;</span><br><span class="line">    </span><br><span class="line">    CGMutablePathRef curvedPath = CGPathCreateMutable();</span><br><span class="line">    CGAffineTransform t2 = CGAffineTransformConcat(CGAffineTransformConcat(</span><br><span class="line">                                                                           CGAffineTransformMakeTranslation(-origin_x, -origin_y),</span><br><span class="line">                                                                           CGAffineTransformMakeScale(1, radiuscale)),</span><br><span class="line">                                                   CGAffineTransformMakeTranslation(origin_x, origin_y));</span><br><span class="line">    CGPathAddArc(curvedPath, &amp;t2, origin_x, origin_y, radiusX,startAngle,endAngle, 1);</span><br><span class="line">    pathAnimation.path = curvedPath;</span><br><span class="line">    CGPathRelease(curvedPath);</span><br></pre></td></tr></table></figure></p>
<p>好了，至此，动画的轨迹和属性都写好了。添加到view上就ok了。</p>
<p>3.贝塞尔画椭圆<br>如果是整个椭圆的话，只需要设定好理想中的椭圆的外切圆即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    //整个椭圆</span><br><span class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</span><br><span class="line">    CGContextSaveGState(context);</span><br><span class="line">    UIBezierPath *arc = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(origin_x-100, origin_y-50, 200, 100)];</span><br><span class="line">    [[UIColor whiteColor] setStroke];</span><br><span class="line">    [arc stroke];</span><br><span class="line">    CGContextRestoreGState(context);</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>总结: 希望本文能对你有帮助。如果你有更好的想法,欢迎和我交流! </strong><br>demo地址:<a href="https://github.com/xiaochenyi/CircleAnimateDemo" target="_blank" rel="noopener">https://github.com/xiaochenyi/CircleAnimateDemo</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/02/06/iOS-一步一步实现百度地图范围搜索/" class="prev">上一篇</a><a href="/2018/02/06/通俗易懂的讲解iOS中的证书知识/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>