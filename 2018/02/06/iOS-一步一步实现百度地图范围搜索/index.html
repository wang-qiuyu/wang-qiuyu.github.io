<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOS 一步一步实现百度地图范围搜索 · qiuyu's Blog</title><meta name="description" content="iOS 一步一步实现百度地图范围搜索 - wang-qiuyu"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="qiuyu's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/u/5677800872" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/wang-qiuyu" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://www.jianshu.com/u/fd067b9ce42f" target="_blank" class="nav-list-link">简书</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOS 一步一步实现百度地图范围搜索</h1><div class="post-info">Feb 6, 2018</div><div class="post-content"><h4 id="实现百度地图显示范围内搜索关键词"><a href="#实现百度地图显示范围内搜索关键词" class="headerlink" title="实现百度地图显示范围内搜索关键词"></a>实现百度地图显示范围内搜索关键词</h4><p>效果图:<br><img src="http://upload-images.jianshu.io/upload_images/299599-b0d1d87d2a8c2cdc.gif?imageMogr2/auto-orient/strip" alt="未命名.gif"></p>
<h5 id="实现原理-首先-要实现范围内搜索-就得借助地图搜索类方法-去百度地图SDK里查看-发现根据范围和搜索词的方法正是我们所需要的"><a href="#实现原理-首先-要实现范围内搜索-就得借助地图搜索类方法-去百度地图SDK里查看-发现根据范围和搜索词的方法正是我们所需要的" class="headerlink" title="实现原理: 首先,要实现范围内搜索,就得借助地图搜索类方法,去百度地图SDK里查看,发现根据范围和搜索词的方法正是我们所需要的."></a>实现原理: 首先,要实现范围内搜索,就得借助地图搜索类方法,去百度地图SDK里查看,发现根据范围和搜索词的方法正是我们所需要的.</h5><p><img src="http://upload-images.jianshu.io/upload_images/299599-2977562346ac8d5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照_2016-06-16_下午3_27_11.png"></p>
<h6 id="接着去-BMKBoundSearchOption-里查看-发现要实现范围搜索只需要得到左下角和右上角的经纬度坐标点即可。"><a href="#接着去-BMKBoundSearchOption-里查看-发现要实现范围搜索只需要得到左下角和右上角的经纬度坐标点即可。" class="headerlink" title="接着去 BMKBoundSearchOption 里查看,发现要实现范围搜索只需要得到左下角和右上角的经纬度坐标点即可。"></a>接着去 BMKBoundSearchOption 里查看,发现要实现范围搜索只需要得到左下角和右上角的经纬度坐标点即可。</h6><p><img src="http://upload-images.jianshu.io/upload_images/299599-2c38bae8df72e1ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2016-06-16 下午3.34.45.png"></p>
<p>1.首先加载出百度地图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    _mapView = [[BMKMapView alloc] initWithFrame:CGRectMake(0, 0, [UIScreen mainScreen].bounds.size.width, [UIScreen mainScreen].bounds.size.height)];</span><br><span class="line">    // 设置地图级别</span><br><span class="line">    [_mapView setZoomLevel:16];</span><br><span class="line">    _mapView.delegate= self;</span><br><span class="line">    _mapView.isSelectedAnnotationViewFront = YES;</span><br><span class="line">    [self.view addSubview:_mapView];</span><br></pre></td></tr></table></figure></p>
<p>2.在地图加载成功后的方法里去得到左下角和右上角的坐标点的经纬度, 需要一个方法来实现屏幕坐标点转化成经纬度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//加载完毕先调取一次检索</span><br><span class="line">- (void)mapViewDidFinishLoading:(BMKMapView *)mapView</span><br><span class="line">&#123;</span><br><span class="line">    leftBottomPoint = [_mapView convertPoint:CGPointMake(0,_mapView.frame.size.height) toCoordinateFromView:mapView];  // //西南角（左下角） 屏幕坐标转地理经纬度</span><br><span class="line">    rightBottomPoint = [_mapView convertPoint:CGPointMake(_mapView.frame.size.width,0) toCoordinateFromView:mapView];  //东北角（右上角）同上</span><br><span class="line">    //开始搜索</span><br><span class="line">    [self beginSearch];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.得到俩个点的经纬度就可以开始发起搜索了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (void)beginSearch&#123;</span><br><span class="line">    _poisearch = [[BMKPoiSearch alloc]init];</span><br><span class="line">    _poisearch.delegate = self;</span><br><span class="line">    </span><br><span class="line">    BMKBoundSearchOption *boundSearchOption = [[BMKBoundSearchOption alloc]init];</span><br><span class="line">    boundSearchOption.pageIndex = 0;</span><br><span class="line">    boundSearchOption.pageCapacity = 20;</span><br><span class="line">    boundSearchOption.keyword = @&quot;烤鱼&quot;;</span><br><span class="line">    boundSearchOption.leftBottom =leftBottomPoint;</span><br><span class="line">    boundSearchOption.rightTop =rightBottomPoint;</span><br><span class="line">    </span><br><span class="line">    BOOL flag = [_poisearch poiSearchInbounds:boundSearchOption];</span><br><span class="line">    if(flag)</span><br><span class="line">    &#123;</span><br><span class="line">        NSLog(@&quot;范围内检索发送成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        NSLog(@&quot;范围内检索发送失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.在搜索结果的代理方法里将搜索到的结果展示出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark implement BMKSearchDelegate</span><br><span class="line">- (void)onGetPoiResult:(BMKPoiSearch *)searcher result:(BMKPoiResult*)result errorCode:(BMKSearchErrorCode)error</span><br><span class="line">&#123;</span><br><span class="line">    if (error == BMK_SEARCH_NO_ERROR) &#123;</span><br><span class="line">        NSArray* array = [NSArray arrayWithArray:_mapView.annotations];</span><br><span class="line">        [_mapView removeAnnotations:array];</span><br><span class="line">        array = [NSArray arrayWithArray:_mapView.overlays];</span><br><span class="line">        [_mapView removeOverlays:array];</span><br><span class="line">        //在此处理正常结果</span><br><span class="line">        for (int i = 0; i &lt; result.poiInfoList.count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            BMKPoiInfo* poi = [result.poiInfoList objectAtIndex:i];</span><br><span class="line">            [self addAnimatedAnnotationWithName:poi.name withAddress:poi.pt];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125; else if (error == BMK_SEARCH_AMBIGUOUS_ROURE_ADDR)&#123;</span><br><span class="line">        NSLog(@&quot;起始点有歧义&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 各种情况的判断。。。</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 添加动画Annotation</span><br><span class="line">- (void)addAnimatedAnnotationWithName:(NSString *)name withAddress:(CLLocationCoordinate2D)coor &#123;</span><br><span class="line">    </span><br><span class="line">    BMKPointAnnotation*animatedAnnotation = [[BMKPointAnnotation alloc]init];</span><br><span class="line">    animatedAnnotation.coordinate = coor;</span><br><span class="line">    animatedAnnotation.title = name;</span><br><span class="line">    [_mapView addAnnotation:animatedAnnotation];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.当地图区域发生改变时,会触发的方法有3个: “正在改变”、”即将改变”、”改变完成”。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/299599-62e02b40276d6d6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照_2016-06-16_下午3_54_33.png"></p>
<p>很容易就想到,我们需要使用的是”改变完成”的方法,在里面重新请求一次搜索:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)mapView:(BMKMapView *)mapView regionDidChangeAnimated:(BOOL)animated&#123;</span><br><span class="line">    </span><br><span class="line">    leftBottomPoint = [_mapView convertPoint:CGPointMake(0,_mapView.frame.size.height) toCoordinateFromView:mapView];  // //西南角（左下角） 屏幕坐标转地理经纬度</span><br><span class="line">    rightBottomPoint = [_mapView convertPoint:CGPointMake(_mapView.frame.size.width,0) toCoordinateFromView:mapView];  //东北角（右上角）同上</span><br><span class="line">    </span><br><span class="line">    [self beginSearch];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结: demo只实现了一个很基础的功能,后期还可以增加更加炫酷的功能,比如改变气泡的形状。如果你有更好的想法,欢迎和我交流! </strong><br>demo地址:<a href="https://github.com/wang-qiuyu/BoundsSearchDemo" target="_blank" rel="noopener">https://github.com/wang-qiuyu/BoundsSearchDemo</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/02/06/iOS圆球沿着椭圆轨迹做动画/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">wang-qiuyu</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>